<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>JacobianCGTest.h</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="ct_logo_small.png"/></td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">- 3.0.1 core module.</div>
    </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="../../../ct_doc/doc/html/index.html"><span>Home</span></a></li>
      <li><a href="../../../ct_core/doc/html/index.html"><span>Core&#160;module</span></a></li>
      <li><a href="../../../ct_optcon/doc/html/index.html"><span>Optimal&#160;Control</span></a></li>
      <li><a href="../../../ct_rbd/doc/html/index.html"><span>Robot&#160;Module</span></a></li>
      <li><a href="../../../ct_models/doc/html/index.html"><span>Models</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('JacobianCGTest_8h-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">JacobianCGTest.h</div>  </div>
</div><!--header-->
<div class="contents">
<p>A simple example on how to use Auto-Diff Codegeneration to compute the Jacobian (derivative) of a general function <img class="formulaInl" alt="$ y = f(x) $" src="form_18.png"/>.</p>
<dl class="section note"><dt>Note</dt><dd>This test gets run by <a class="el" href="CodegenTests_8cpp.html">CodegenTests.cpp</a> to ensure all codegen tests do NOT run in parallel.</dd></dl>
<div class="fragment"><div class="line"><span class="comment">/**********************************************************************************************************************</span></div><div class="line"><span class="comment">This file is part of the Control Toolbox (https://github.com/ethz-adrl/control-toolbox), copyright by ETH Zurich.</span></div><div class="line"><span class="comment">Licensed under the BSD-2 license (see LICENSE file in main directory)</span></div><div class="line"><span class="comment">**********************************************************************************************************************/</span></div><div class="line"><span class="preprocessor">#pragma once</span></div><div class="line"></div><div class="line"><span class="comment">// define the input and output sizes of the function</span></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> <a name="a0"></a><a class="code" href="JacobianCGTest_8h.html#a56010966e672f08abac82c65ade9e810">inDim</a> = 3;   </div><div class="line"><span class="keyword">const</span> <span class="keywordtype">size_t</span> <a name="a1"></a><a class="code" href="JacobianCGTest_8h.html#ac0f3320584f933f86e3a1ac6d70ec968">outDim</a> = 2;  </div><div class="line"></div><div class="line"><span class="keyword">typedef</span> DerivativesCppadJIT&lt;inDim, outDim&gt; <a name="a2"></a><a class="code" href="JacobianCGTest_8h.html#ac2422916ae8c78ff34f1c9fe08da8e46">derivativesCppadJIT</a>;</div><div class="line"><span class="keyword">typedef</span> DerivativesCppadCG&lt;inDim, outDim&gt; <a name="a3"></a><a class="code" href="JacobianCGTest_8h.html#aec47c1b7e90c8231f99b3240093bb643">derivativesCppadCG</a>;</div><div class="line"><span class="keyword">typedef</span> DerivativesCppad&lt;inDim, outDim&gt; <a name="a4"></a><a class="code" href="JacobianCGTest_8h.html#affb68714bc992c091dd3ac6d682c71d8">derivativesCppad</a>;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> SCALAR&gt;</div><div class="line">Eigen::Matrix&lt;SCALAR, outDim, 1&gt; <a name="a5"></a><a class="code" href="JacobianCGTest_8h.html#ab35d4df673b08e2eadd66452d9eeedf3">testFunction</a>(<span class="keyword">const</span> Eigen::Matrix&lt;SCALAR, inDim, 1&gt;&amp; <a name="a6"></a>x)</div><div class="line">{</div><div class="line">    Eigen::Matrix&lt;SCALAR, outDim, 1&gt; y;</div><div class="line"></div><div class="line">    y(0) = 3 * x(0) + 2 * x(0) * x(0) - x(1) * x(2);</div><div class="line">    y(1) = x(2) + x(1) + 3;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> y;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> SCALAR&gt;</div><div class="line">Eigen::Matrix&lt;SCALAR, outDim, inDim&gt; <a name="a7"></a><a class="code" href="JacobianCGTest_8h.html#add60cfbea25b295b9d4497ff8539f3a7">jacobianCheck</a>(<span class="keyword">const</span> Eigen::Matrix&lt;SCALAR, inDim, 1&gt;&amp; <a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/LoadFromFileTest_8cpp.html#a04574b9dfebf2cc8f872b0c757bd7f06">x</a>)</div><div class="line">{</div><div class="line">    Eigen::Matrix&lt;SCALAR, outDim, inDim&gt; jac;</div><div class="line"></div><div class="line">    jac &lt;&lt; 3 + 4 * x(0), -x(2), -x(1), 0, 1, 1;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> jac;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> SCALAR&gt;</div><div class="line">Eigen::Matrix&lt;SCALAR, inDim, inDim&gt; <a name="a8"></a><a class="code" href="JacobianCGTest_8h.html#a37542292bd7e05938feb76c60fa828d4">hessianCheck</a>(<span class="keyword">const</span> Eigen::Matrix&lt;SCALAR, inDim, 1&gt;&amp; <a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/LoadFromFileTest_8cpp.html#a04574b9dfebf2cc8f872b0c757bd7f06">x</a>,</div><div class="line">    <span class="keyword">const</span> Eigen::Matrix&lt;SCALAR, outDim, 1&gt;&amp; w)</div><div class="line">{</div><div class="line">    Eigen::Matrix&lt;SCALAR, inDim, inDim&gt; hes;</div><div class="line"></div><div class="line">    hes &lt;&lt; 4, 0, 0, 0, 0, -1, 0, -1, 0;</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> w(0) * hes;</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><a name="a9"></a><a class="code" href="JacobianCGTest_8h.html#a5303c0d85b2d4f86c19e5ab98dbb937d">TEST</a>(JacobianCGTest, ForwardZeroTest)</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span></div><div class="line">    {</div><div class="line">        <span class="comment">// create a function handle (also works for class methods, lambdas, function pointers, ...)</span></div><div class="line">        <span class="keyword">typename</span> derivativesCppadJIT::FUN_TYPE_CG f_cg = testFunction&lt;derivativesCppadJIT::CG_SCALAR&gt;;</div><div class="line">        <span class="keyword">typename</span> derivativesCppad::FUN_TYPE_AD f_ad = testFunction&lt;derivativesCppad::AD_SCALAR&gt;;</div><div class="line"></div><div class="line">        <span class="comment">// initialize the Auto-Diff Codegen Jacobian</span></div><div class="line">        <a class="code" href="JacobianCGTest_8h.html#ac2422916ae8c78ff34f1c9fe08da8e46">derivativesCppadJIT</a> jacCG(f_cg);</div><div class="line">        <a class="code" href="JacobianCGTest_8h.html#affb68714bc992c091dd3ac6d682c71d8">derivativesCppad</a> jacAd(f_ad);</div><div class="line"></div><div class="line">        DerivativesCppadSettings settings;</div><div class="line">        settings.createForwardZero_ = <span class="keyword">true</span>;</div><div class="line">        settings.createJacobian_ = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">        <span class="comment">// create a random double vector</span></div><div class="line">        Eigen::VectorXd someVec(<a class="code" href="JacobianCGTest_8h.html#a56010966e672f08abac82c65ade9e810">inDim</a>);</div><div class="line">        someVec.setRandom();</div><div class="line"></div><div class="line">        <span class="comment">// test evaluation of forward zero before compilation</span></div><div class="line">        Eigen::VectorXd vecOut = jacAd.forwardZero(someVec);</div><div class="line"></div><div class="line">        <span class="comment">// compile the Jacobian</span></div><div class="line">        jacCG.compileJIT(settings, <span class="stringliteral">&quot;forwardZeroTestLib&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">// test evaluation of forward zero after compilation</span></div><div class="line">        Eigen::VectorXd vecOut2 = jacCG.forwardZero(someVec);</div><div class="line"></div><div class="line">        <span class="comment">// verify the outputs</span></div><div class="line">        ASSERT_LT((vecOut - vecOut2).array().abs().maxCoeff(), 1e-10);</div><div class="line"></div><div class="line">    } <span class="keywordflow">catch</span> (std::exception&amp; e)</div><div class="line">    {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Exception thrown: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">        ASSERT_TRUE(<span class="keyword">false</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><a class="code" href="JacobianCGTest_8h.html#a5303c0d85b2d4f86c19e5ab98dbb937d">TEST</a>(JacobianCGTest, JITCompilationTest)</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span></div><div class="line">    {</div><div class="line">        <span class="comment">// create a function handle (also works for class methods, lambdas, function pointers, ...)</span></div><div class="line">        <span class="keyword">typename</span> derivativesCppadJIT::FUN_TYPE_CG f = testFunction&lt;derivativesCppadJIT::CG_SCALAR&gt;;</div><div class="line">        <span class="keyword">typename</span> derivativesCppad::FUN_TYPE_AD f_ad = testFunction&lt;derivativesCppad::AD_SCALAR&gt;;</div><div class="line"></div><div class="line">        <span class="comment">// initialize the Auto-Diff Codegen Jacobian</span></div><div class="line">        <a class="code" href="JacobianCGTest_8h.html#ac2422916ae8c78ff34f1c9fe08da8e46">derivativesCppadJIT</a> jacCG(f);</div><div class="line">        <a class="code" href="JacobianCGTest_8h.html#affb68714bc992c091dd3ac6d682c71d8">derivativesCppad</a> jacAd(f_ad);</div><div class="line"></div><div class="line">        DerivativesCppadSettings settings;</div><div class="line">        settings.createJacobian_ = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">        <span class="comment">// compile the Jacobian</span></div><div class="line">        jacCG.compileJIT(settings, <span class="stringliteral">&quot;jacobianCGLib&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">// create an input vector</span></div><div class="line">        Eigen::Matrix&lt;double, inDim, 1&gt; <a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/LoadFromFileTest_8cpp.html#a04574b9dfebf2cc8f872b0c757bd7f06">x</a>;</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a name="a10"></a><a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/mpc__unittest__plotting_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/mpc__unittest__plotting_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 1000; <a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/mpc__unittest__plotting_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)</div><div class="line">        {</div><div class="line">            <span class="comment">// create a random input</span></div><div class="line">            x.setRandom();</div><div class="line"></div><div class="line">            <span class="comment">// verify agains the analytical Jacobian</span></div><div class="line">            ASSERT_LT((jacCG.jacobian(x) - <a class="code" href="JacobianCGTest_8h.html#add60cfbea25b295b9d4497ff8539f3a7">jacobianCheck</a>(x)).array().abs().maxCoeff(), 1e-10);</div><div class="line">            ASSERT_LT((jacAd.jacobian(x) - <a class="code" href="JacobianCGTest_8h.html#add60cfbea25b295b9d4497ff8539f3a7">jacobianCheck</a>(x)).array().abs().maxCoeff(), 1e-10);</div><div class="line">            ASSERT_LT((jacCG.jacobian(x) - jacAd.jacobian(x)).array().abs().maxCoeff(), 1e-10);</div><div class="line">        }</div><div class="line">    } <span class="keywordflow">catch</span> (std::exception&amp; e)</div><div class="line">    {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Exception thrown: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">        ASSERT_TRUE(<span class="keyword">false</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><a class="code" href="JacobianCGTest_8h.html#a5303c0d85b2d4f86c19e5ab98dbb937d">TEST</a>(HessianCGTest, JITHessianTest)</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span></div><div class="line">    {</div><div class="line">        <span class="keyword">typename</span> derivativesCppadJIT::FUN_TYPE_CG f = testFunction&lt;derivativesCppadJIT::CG_SCALAR&gt;;</div><div class="line">        <span class="keyword">typename</span> derivativesCppad::FUN_TYPE_AD f_ad = testFunction&lt;derivativesCppad::AD_SCALAR&gt;;</div><div class="line"></div><div class="line">        <a class="code" href="JacobianCGTest_8h.html#ac2422916ae8c78ff34f1c9fe08da8e46">derivativesCppadJIT</a> hessianCg(f);</div><div class="line">        <a class="code" href="JacobianCGTest_8h.html#affb68714bc992c091dd3ac6d682c71d8">derivativesCppad</a> hessianAd(f_ad);</div><div class="line"></div><div class="line">        DerivativesCppadSettings settings;</div><div class="line">        settings.createHessian_ = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">        hessianCg.compileJIT(settings, <span class="stringliteral">&quot;hessianCGLib&quot;</span>);</div><div class="line"></div><div class="line">        Eigen::Matrix&lt;double, inDim, 1&gt; <a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/LoadFromFileTest_8cpp.html#a04574b9dfebf2cc8f872b0c757bd7f06">x</a>;</div><div class="line">        Eigen::Matrix&lt;double, outDim, 1&gt; w;</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/mpc__unittest__plotting_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/mpc__unittest__plotting_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 1000; ++<a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/mpc__unittest__plotting_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>)</div><div class="line">        {</div><div class="line">            x.setRandom();</div><div class="line">            w.setRandom();</div><div class="line"></div><div class="line">            ASSERT_LT((hessianCg.hessian(x, w) - <a class="code" href="JacobianCGTest_8h.html#a37542292bd7e05938feb76c60fa828d4">hessianCheck</a>(x, w)).array().abs().maxCoeff(), 1e-10);</div><div class="line">            ASSERT_LT((hessianAd.hessian(x, w) - <a class="code" href="JacobianCGTest_8h.html#a37542292bd7e05938feb76c60fa828d4">hessianCheck</a>(x, w)).array().abs().maxCoeff(), 1e-10);</div><div class="line">            ASSERT_LT((hessianCg.hessian(x, w) - hessianAd.hessian(x, w)).array().abs().maxCoeff(), 1e-10);</div><div class="line">        }</div><div class="line"></div><div class="line"></div><div class="line">    } <span class="keywordflow">catch</span> (std::exception&amp; e)</div><div class="line">    {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Exception thrown: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">        ASSERT_TRUE(<span class="keyword">false</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><a class="code" href="JacobianCGTest_8h.html#a5303c0d85b2d4f86c19e5ab98dbb937d">TEST</a>(JacobianCGTest, JITCloneTest)</div><div class="line">{</div><div class="line">    <span class="keywordflow">try</span></div><div class="line">    {</div><div class="line">        <span class="keyword">typename</span> derivativesCppadJIT::FUN_TYPE_CG f = testFunction&lt;derivativesCppadJIT::CG_SCALAR&gt;;</div><div class="line">        <span class="keyword">typename</span> derivativesCppad::FUN_TYPE_AD f_ad = testFunction&lt;derivativesCppad::AD_SCALAR&gt;;</div><div class="line"></div><div class="line">        <span class="comment">// initialize the Auto-Diff Codegen Jacobian</span></div><div class="line">        std::shared_ptr&lt;derivativesCppadJIT&gt; jacCG(<span class="keyword">new</span> <a class="code" href="JacobianCGTest_8h.html#ac2422916ae8c78ff34f1c9fe08da8e46">derivativesCppadJIT</a>(f));</div><div class="line">        std::shared_ptr&lt;derivativesCppad&gt; jacAd(<span class="keyword">new</span> <a class="code" href="JacobianCGTest_8h.html#affb68714bc992c091dd3ac6d682c71d8">derivativesCppad</a>(f_ad));</div><div class="line"></div><div class="line">        DerivativesCppadSettings settings;</div><div class="line">        settings.createJacobian_ = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">        <span class="comment">// compile the Jacobian</span></div><div class="line">        jacCG-&gt;compileJIT(settings, <span class="stringliteral">&quot;jacobianCGLib&quot;</span>);</div><div class="line"></div><div class="line">        <span class="comment">// create an input vector</span></div><div class="line">        Eigen::Matrix&lt;double, inDim, 1&gt; <a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/LoadFromFileTest_8cpp.html#a04574b9dfebf2cc8f872b0c757bd7f06">x</a>;</div><div class="line"></div><div class="line">        std::shared_ptr&lt;derivativesCppadJIT&gt; jacCG_cloned(jacCG-&gt;clone());</div><div class="line"></div><div class="line">        <span class="comment">// make sure the underlying dynamic libraries are not identical (dynamic library cloned correctly)</span></div><div class="line">        <span class="keywordflow">if</span> (jacCG_cloned-&gt;getDynamicLib() == jacCG-&gt;getDynamicLib())</div><div class="line">        {</div><div class="line">            std::cout &lt;&lt; <span class="stringliteral">&quot;FATAL ERROR: dynamic library not cloned correctly in JIT.&quot;</span> &lt;&lt; std::endl;</div><div class="line">            ASSERT_TRUE(<span class="keyword">false</span>);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/mpc__unittest__plotting_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> = 0; <a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/mpc__unittest__plotting_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a> &lt; 100; <a class="codeRef" doxygen="/home/adrl/code/src/control-toolbox/ct_doc/doc/tags/ct_optcon.tag:../../../ct_optcon/doc/html/" href="../../../ct_optcon/doc/html/mpc__unittest__plotting_8m.html#a6f6ccfcf58b31cb6412107d9d5281426">i</a>++)</div><div class="line">        {</div><div class="line">            <span class="comment">// create a random input</span></div><div class="line">            x.setRandom();</div><div class="line"></div><div class="line">            <span class="comment">// verify agains the analytical Jacobian</span></div><div class="line">            ASSERT_LT((jacCG_cloned-&gt;jacobian(x) - <a class="code" href="JacobianCGTest_8h.html#add60cfbea25b295b9d4497ff8539f3a7">jacobianCheck</a>(x)).array().abs().maxCoeff(), 1e-10);</div><div class="line">            ASSERT_LT((jacCG_cloned-&gt;jacobian(x) - jacAd-&gt;jacobian(x)).array().abs().maxCoeff(), 1e-10);</div><div class="line">        }</div><div class="line">    } <span class="keywordflow">catch</span> (std::exception&amp; e)</div><div class="line">    {</div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Exception thrown: &quot;</span> &lt;&lt; e.what() &lt;&lt; std::endl;</div><div class="line">        ASSERT_TRUE(<span class="keyword">false</span>);</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// /*!</span></div><div class="line"><span class="comment">//  * Test for writing the codegenerated Jacobian to file</span></div><div class="line"><span class="comment">//  */</span></div><div class="line"><a class="code" href="JacobianCGTest_8h.html#a5303c0d85b2d4f86c19e5ab98dbb937d">TEST</a>(JacobianCGTest, CodegenTest)</div><div class="line">{</div><div class="line">    <span class="comment">// create a function handle (also works for class methods, lambdas, function pointers, ...)</span></div><div class="line">    <span class="keyword">typename</span> derivativesCppadCG::FUN_TYPE_CG f = testFunction&lt;derivativesCppadCG::CG_SCALAR&gt;;</div><div class="line"></div><div class="line">    <span class="comment">// initialize the Auto-Diff Codegen Jacobian</span></div><div class="line">    <a class="code" href="JacobianCGTest_8h.html#aec47c1b7e90c8231f99b3240093bb643">derivativesCppadCG</a> jacCG(f);</div><div class="line"></div><div class="line">    <span class="comment">// generate code for the Jacobian, similar to jacobianCheck()</span></div><div class="line">    jacCG.generateJacobianSource(<span class="stringliteral">&quot;TestJacobian&quot;</span>);</div><div class="line"></div><div class="line">    <span class="comment">// generate code for the actual function, will evaluate to the same as testFunction()</span></div><div class="line">    jacCG.generateForwardZeroSource(<span class="stringliteral">&quot;TestForwardZero&quot;</span>);</div><div class="line"></div><div class="line">    jacCG.generateHessianSource(<span class="stringliteral">&quot;TestHessian&quot;</span>);</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun May 12 2019 22:18:41 by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
