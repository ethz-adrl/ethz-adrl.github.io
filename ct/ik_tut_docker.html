<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>ct: Generate IKFast solvers using a Docker image</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ct
   &#160;<span id="projectnumber">v3.0</span>
   </div>
   <div id="projectbrief">Control Toolbox</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('ik_tut_docker.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Generate IKFast solvers using a Docker image </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#ik_tut_docker_setup">Setting up Docker</a></li>
<li class="level1"><a href="#ik_tut_docker_generate">Generating the solver</a><ul><li class="level2"><a href="#ik_tut_docker_step1">Getting the image</a></li>
<li class="level2"><a href="#ik_tut_docker_step2">Generating the solver</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>In this tutorial we shall cover generating IKFast using <a href="https://www.docker.com/">Docker</a>. Docker container images are lightweight, stand-alone, executable packages that include everything needed to run a software: code, runtime, system tools, system libraries, and configurations. This allows avoiding to deal with software dependencies, and have a software along with all the dependencies set up with just a single command.</p>
<h1><a class="anchor" id="ik_tut_docker_setup"></a>
Setting up Docker</h1>
<p>The first step required in order to be able to run Docker containers is to set up the Docker daemon - the software that is able to execute the containers. There are multiple ways of doing this. Here we shall present the official way of doing this on Linux as of the moment of writing. For a more up-to-date configuration, please consult the official Docker website.</p>
<p>To set up the Docker daemon, simply run the following commands.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;sudo apt-get update</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;sudo apt-get install -y linux-image-extra-$(uname -r) linux-image-extra-virtual apt-transport-https ca-certificates curl software-properties-common</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;sudo apt-key fingerprint 0EBFCD88</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;sudo add-apt-repository -y &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;sudo apt-get update</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;sudo apt-get install -y docker-ce</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;sudo groupadd docker</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;sudo usermod -aG docker $USER</div></div><!-- fragment --><p>After this it is necessary to log out and log in again with the same user so that Docker daemon is able to run with newly defined permissions.</p>
<h1><a class="anchor" id="ik_tut_docker_generate"></a>
Generating the solver</h1>
<p>Now that Docker is up and running, we shall generate the inverse kinematics solver. To do that, we first need to get the Docker image containing IKFast. For this we recommend the image located <a href="https://hub.docker.com/r/hamzamerzic/openrave/">here</a>.</p>
<h2><a class="anchor" id="ik_tut_docker_step1"></a>
Getting the image</h2>
<p>Thus, to obtain the image we can simply run</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;docker pull hamzamerzic/openrave</div></div><!-- fragment --><p>To test if the image works simply run</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;docker run -it hamzamerzic/openrave</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;python -c &#39;import openravepy; print openravepy.__version__&#39;</div></div><!-- fragment --><p>which should give "0.9.0" as output. The second command should be ran within the container's shell.</p>
<h2><a class="anchor" id="ik_tut_docker_step2"></a>
Generating the solver</h2>
<p>The image that was obtained contains all the dependencies needed to run IKFast's solver generation. To do this make sure you have the DAE or URDF file of your robot. In case you only have a URDF file an intermediate step needs to be done in order to convert it to DAE. To do that, make sure you have ROS and ros-&lt;ros_version&gt;-collada-urdf package installed and run</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;rosrun collada_urdf urdf_to_collada &lt;robot_urdf&gt; robot_full.dae</div></div><!-- fragment --><p>Optionally, you can round the floating numbers in the DAE file for better numeric stability. To do that simply run</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;rosrun moveit_kinematics round_collada_numbers.py robot_full.dae robot.dae 6</div></div><!-- fragment --><p>Here 6 specifies the number of decimal places we wish to keep. You can experiment with the precision. In the next steps we assume that the robot file is robot.dae.</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;docker run --rm --env PYTHONPATH=/usr/local/lib/python2.7/dist-packages -v &lt;path_to_robot_file_directory&gt;:/out hamzamerzic/openrave /bin/bash -c &quot;cd /out; openrave-robot.py robot.dae --info links&quot;</div></div><!-- fragment --><p>As output you should get something like</p>
<div class="fragment"><div class="line">name   index parents</div><div class="line">--------------------</div><div class="line">link_0 0</div><div class="line">link_1 1     link_0</div><div class="line">link_2 2     link_1</div><div class="line">link_3 3     link_2</div><div class="line">link_4 4     link_3</div><div class="line">link_5 5     link_4</div><div class="line">link_6 6     link_5</div><div class="line">--------------------</div><div class="line">name   index parents</div></div><!-- fragment --><p>The important things to look for are the indices as we need them in order to specify from which to which link to calculate the inverse kinematics. In case the indices are not showing, you should consult with the FAQ.</p>
<p>Now that we know which indices correspond to the base link and to the end effector link, we can continue with generating the solver. To do that simply run</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;docker run --rm --env PYTHONPATH=/usr/local/lib/python2.7/dist-packages -v &lt;path_to_robot_file_directory&gt;:/out hamzamerzic/openrave /bin/bash -c &quot;cd /out; python /usr/local/lib/python2.7/dist-packages/openravepy/_openravepy_/ikfast.py --robot=robot.dae --iktype=transform6d --baselink=0 --eelink=6 --savefile=custom_ik.cpp&quot;</div></div><!-- fragment --><p>Here we assumed that the baselink and end effector links are 0 and 6, respectively. For the inverse kinematics type, we used the full Transform6D inverse kinematics, but other options are also <a href="http://openrave.org/docs/latest_stable/openravepy/ikfast">available</a>.</p>
<p>Now that we have the solver in place we can skip directly to the <a class="el" href="ik_implement.html">Build IKFast library</a> page. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="getting_started.html">Getting Started</a></li><li class="navelem"><a class="el" href="ik_tutorials.html">Inverse Kinematics Tutorials</a></li>
    <li class="footer">Generated on Sat Apr 27 2019 11:45:04 for ct by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
