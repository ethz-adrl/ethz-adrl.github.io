<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>ct: Model a Rigid Body Dynamics system</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ct
   &#160;<span id="projectnumber">v3.0</span>
   </div>
   <div id="projectbrief">Control Toolbox</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('rbd_tut_modelling.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Model a Rigid Body Dynamics system </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#rbd_tut_modelling_robcogen">Creating an new model</a><ul><li class="level2"><a href="#rbd_tut_robcogen">Step 1: Create your model using RobCoGen</a></li>
<li class="level2"><a href="#rbd_tut_robcogen_import">Step 2: Create a model for CT</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p>In this tutorial, we will create a simple Rigid Body Dynamics system.</p>
<h1><a class="anchor" id="rbd_tut_modelling_robcogen"></a>
Creating an new model</h1>
<p>The Rigid Body Dynamics module of the Control Toolbox relies on <a href="https://robcogenteam.bitbucket.io">RobCoGen</a>, a code-generation framework for Rigid Body Dynamics and Kinematics. This involves a separate code generation step for creating the dynamics and kinematics equations prior to using your model in the Control Toolbox. However, as of writing this documentation, RobCoGen is the only Rigid Body Dynamics framework that supports Auto-Differentiation, a major ingredient for fast Optimal Control. We plan to support more modelling frameworks in the future.</p>
<p>RobCoGen requires a special robot description format (kindsl). If you already have a URDF description of your robot, you can use the <a href="https://github.com/leggedrobotics/urdf2robcogen">urdf2robcogen</a> converter.</p>
<h2><a class="anchor" id="rbd_tut_robcogen"></a>
Step 1: Create your model using RobCoGen</h2>
<p>As a first step, download RobCoGen version 0.4ad.0 from the <a href="https://robcogenteam.bitbucket.io/binary.html">official website</a>. Follow the instruction on the website for creating your kindsl and dtdsl files. Generate all C++ outputs.</p>
<h2><a class="anchor" id="rbd_tut_robcogen_import"></a>
Step 2: Create a model for CT</h2>
<p>As a next step, we suggest to first create a new package</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cd catkin_ws/src</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;catkin_create_pkg my_robot ct_rbd</div></div><!-- fragment --><p>As you can see, we made our package depend on ct_rbd. Next, we create the folder structure</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;cd my_robot</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;mkdir -p include/my_robot/generated</div></div><!-- fragment --><p>Copy all files generated by RobCoGen into this folder. We generally recommend adding your kindsl/dtdsl files to a subfolder called "model" as well for later reference.</p>
<p>Next, edit the CMakeLists.txt in your package and add the following lines:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;include_directories(</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;  include</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;  ${catkin_INCLUDE_DIRS}</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;)</div></div><!-- fragment --><p>Next, create a header file for your robot in include/my_robot/MyRobot.h with the following content</p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;Eigen/Core&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;Eigen/StdVector&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;generated/declarations.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;generated/jsim.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;generated/jacobians.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;generated/traits.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;generated/forward_dynamics.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;generated/inertia_properties.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;generated/inverse_dynamics.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;generated/transforms.h&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;generated/link_data_map.h&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// define namespace and base</span></div><div class="line"><span class="preprocessor">#define ROBCOGEN_NS ct_my_robot</span></div><div class="line"><span class="preprocessor">#define TARGET_NS MyRobot</span></div><div class="line"></div><div class="line"><span class="comment">// define the links</span></div><div class="line"><span class="preprocessor">#define CT_BASE fr_MyRobotBase</span></div><div class="line"><span class="preprocessor">#define CT_L0 fr_Shoulder_AA</span></div><div class="line"><span class="preprocessor">#define CT_L1 fr_Shoulder_FE</span></div><div class="line"><span class="preprocessor">#define CT_L2 fr_Humerus_R</span></div><div class="line"><span class="preprocessor">#define CT_L3 fr_Elbow_FE</span></div><div class="line"><span class="preprocessor">#define CT_L4 fr_Wrist_R</span></div><div class="line"><span class="preprocessor">#define CT_L5 fr_Wrist_FE</span></div><div class="line"></div><div class="line"><span class="comment">// define single end effector (could also be multiple)</span></div><div class="line"><span class="preprocessor">#define CT_N_EE 1</span></div><div class="line"><span class="preprocessor">#define CT_EE0 fr_ee</span></div><div class="line"><span class="preprocessor">#define CT_EE0_IS_ON_LINK 5</span></div><div class="line"><span class="preprocessor">#define CT_EE0_FIRST_JOINT 0</span></div><div class="line"><span class="preprocessor">#define CT_EE0_LAST_JOINT 5</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;ct/rbd/robot/robcogen/robcogenHelpers.h&gt;</span></div></div><!-- fragment --><p>You need to adjust a few variables. First, set the namespace (ROBCOGEN_NS) which the RobCoGen files have been created in. Also, you can define a target namespace (MyRobot). Next, you need to define your base link (CT_BASE, which is either floating or fixed, depending on your kindsl). Afterwards, define all links (CT_L0, CT_L1, CT_L2, ...) by using the frames you defined in RobCoGen. Last but not least, you can but do not have to specify endeffectors. Endeffectors can be useful for contacts or optimal control. If in doubt, skip these for now.</p>
<p>Once you need end-effectors, specify their number (CT_N_EE). Then, for each end-effector, specify its name in RobCoGen (CT_EEx) and which link it is rigidly attached to (CT_EEx_IS_ON_LINK). Then specify the first joint in the kinematic chain leading up to the end-effector (CT_EEx_FIRST_JOINT, often but not necessarily 0) as well as the last joint (CT_EEx_LAST_JOINT). The Control Toolbox assumes that all joint numbers in between those two also influence the end-effector.</p>
<p>Above steps automatically create the following useful types:</p>
<div class="fragment"><div class="line">ct::rbd::MyRobot::Dynamics myRobotDynamics; <span class="comment">// an implementation of ct::rbd::Dynamics for your robot</span></div><div class="line">ct::rbd::MyRobot::tpl::Dynamics&lt;SCALAR&gt; myRobotDynamicsTpl; <span class="comment">// an implementation of ct::rbd::Dynamics for your robot templated on the scalar type!</span></div><div class="line"></div><div class="line">ct::rbd::MyRobot::Kinematics myRobotKinematics; <span class="comment">// an implementation of ct::rbd::Kinematics for your robot</span></div></div><!-- fragment --><p>The Dynamics and Kinematics class have some useful functions including computing forward and inverse dynamics as well as transforms and Jacobians. Please refer to the documentation for more details.</p>
<p>That's it! You can verify your setup by looking into the ct models package, e.g. at the HyA robot. Feel free to check out our tutorials on how to <a class="el" href="rbd_tut_forward_dynamics.html">Simulate your robot and create a controller</a> as well as <a class="el" href="rbd_tut_types.html">Useful RBD types</a>. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="getting_started.html">Getting Started</a></li><li class="navelem"><a class="el" href="rbd_tutorials.html">ct rbd Tutorials</a></li>
    <li class="footer">Generated on Sat Apr 27 2019 11:45:04 for ct by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.11 </li>
  </ul>
</div>
</body>
</html>
